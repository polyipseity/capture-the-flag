const BASE_URL="http://20.55.39.17:1337",WS_URL="ws://20.55.39.17:1337";var socket,activeServer="0";const token=localStorage.getItem("token"),getUserIcon=e=>{try{var a=e.split(" ");if(a.length>1)return(a[0][0]+a[1][0]).toUpperCase();return a[0].slice(0,2).toUpperCase()}catch{return"XL"}},addMessage=(e,a)=>{var t=$('<div class="msg-container"></div>'),r=$('<div class="msg-author-icon"></div>');r.text(getUserIcon(a)),t.append(r);var s=$('<div class="msg-body"></div>'),n=$('<div class="msg-author-name"></div>');n.text(a);var i,o=$('<div class="msg-details"></div>');o.text(e),s.append(n),s.append(o),t.append(s),$(".chat-container").append(t)},addLink=(e,a,t,r,s=!1)=>{var n=$('<div class="msg-container"></div>'),i=$('<div class="msg-author-icon"></div>');i.text(getUserIcon(r)),n.append(i);var o=$('<div class="msg-body"></div>'),d=$('<div class="msg-author-name"></div>');d.text(r);var v=$('<a href="" class="msg-link"></a>');v.text(e),v.attr("href","#"),o.append(d),o.append(v);var c=$('<div class="msg-link-metadata"></div>'),p=$('<a href="" class="msg-link-title"></a>');p.text(a),p.attr("href","#");var l=$('<div class="msg-link-desc"></div>');if(l.append(t),c.append(p),c.append(l),s){var m=$('<img src="" class="msg-link-img">');m.attr("src",s),c.append(m)}o.append(c),n.append(o),$(".chat-container").append(n)},appendMembers=e=>{for(let a of($(".members-cat").text(`MEMBERS - ${e.length}`),e)){var t=$('<div class="member-container"></div>'),r=$('<div class="member-img"></div>');r.text(getUserIcon(a)),r.css("background",getRandomColor());var s=$('<div class="member-name"></div>');s.text(a),t.append(r),t.append(s),$(".members-panel").append(t)}},appendServer=e=>{console.log(e);var a=$('<div class="server-icon"></div>'),t=e.id;a.text(getUserIcon(e.name)),$(".servers-panel").append(a),a.on("click",async function(){await openServer(t,a)})},openServer=async(e,a)=>{if(activeServer!=e){socket.emit("leaveChat",activeServer),socket.emit("joinChat",e),$(".servers-panel div").removeClass("server-active"),a.addClass("server-active"),clearData(),activeServer=e;var t=await getServer(e);for(let r of t.messages)"text"==r.type?addMessage(r.msg,r.author):addLink(r.link,r.title,r.description,r.author,r.img);$(".server-name").text(t.name),appendMembers(t.members),$(".welcome-screen").hide(),$(".channels-panel").show(),$(".chat-panel").show(),$(".members-panel").show(),$(".invite-code-container .dialog-container .dialog-desc").text("Invite friends to "+t.name),ScrollToEnd()}},clearData=()=>{$(".chat-container").html(""),$(".members-panel").html('<div class="members-cat">MEMBERS - 0</div>')},getRandomColor=()=>{for(var e="0123456789ABCDEF",a="#",t=0;t<6;t++)a+=e[Math.floor(16*Math.random())];return a},getFormData=e=>{var a=e.serializeArray(),t={};return $.map(a,function(e,a){t[e.name]=e.value}),t},getServers=async()=>{var e,a=await (await fetch(BASE_URL+"/servers",{method:"GET",headers:{authorization:token}})).json();return console.log(a),a.joinedServers},getServer=async e=>{var a,t;return await (await fetch(BASE_URL+"/servers/"+e,{method:"GET",headers:{authorization:token}})).json()},joinServer=async e=>{var a=await fetch(BASE_URL+"/servers",{method:"PATCH",headers:{authorization:token,"content-type":"application/json"},body:JSON.stringify(e)}),t=await a.json();return 200==a.status?(pushSuccessNotify("DisLaugh",t.message),t.server):(pushErrorNotify("DisLaugh",t.message),!1)},createServer=async e=>{var a=await fetch(BASE_URL+"/servers",{method:"POST",headers:{authorization:token,"content-type":"application/json"},body:JSON.stringify(e)}),t=await a.json();return 201==a.status?(pushSuccessNotify("DisLaugh",t.message),t.server):(pushErrorNotify("DisLaugh",t.message),!1)},sendMessage=async(e,a)=>{var t=await fetch(BASE_URL+"/messages",{method:"POST",headers:{authorization:token,"content-type":"application/json"},body:JSON.stringify({sid:e,message:a})}),r=await t.json();return 201==t.status},ScrollToEnd=()=>{var e=$(".chat-container");e.animate({scrollTop:e.prop("scrollHeight")},1e3)},newServer=()=>{$(".join-server-container").fadeToggle(100)};